<!DOCTYPE HTmL>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WeatherHTML16 Color Picker</title>
    <link rel="stylesheet" href="./assets/css/styles.css">
    <style>
        .colorPicker {
            display: block;
            position: absolute;
            width: 250px;
            height: 50px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            background-color: red;
            z-index: 1;
        }

        .center {
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #confirm {
            display: none;
        }
    </style>
</head>

<body>
    <div class="content" style="height: 100vh;">
        <div class="fade-in">
            <h1>üå§Ô∏è WeatherHTML16</h1>
            <h2 id="test">A Simplistic HTML Weather Widget For iOS</h2>
            <div class="spacer1"></div>
            <div class="center">
                <div class="buttonContainer">
                    <input id="picker" class="colorPicker" type="color" />
                    <div id="pickerText" class="buttonText">Tap to Choose a Color</div>
                </div>
                <div class="spacer1"></div>
                <div id="confirm" class="buttonContainer" style="background-color: lightgreen;">
                    <div class="buttonText">Tap to Save and Return</div>
                </div>
            </div>
        </div>
    </div>
    <script>
        window.onload = () => {
            fade();
            deviceCheck();       
        }

        function fade() {

            var fadeIn = document.querySelectorAll(".fade-in");

            for (var i = 0; i < fadeIn.length; i++) {

                var bottomOfObject = fadeIn[i].offsetTop + window.innerHeight / fadeIn[i].offsetTop;
                var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
                var windowHeight = window.innerHeight || document.documentElement.offsetHeight;
                var bottomOfWindow = scrollTop + windowHeight;

                if (bottomOfWindow > bottomOfObject) {

                    fadeIn[i].style.opacity = "1.0";

                }

            };
        };

        window.addEventListener("scroll", fade);

        var test = document.getElementById("test");

        function deviceCheck() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                console.log("Mobile device detected");
                if (navigator.clipboard) {
                    console.log("This browser supports clipboard.");
                    setTimeout(async() => {
                        const text = await navigator.clipboard.readText();
                        if (text.includes("/9j/")) {
                            test.innerText = text;
                        } else {
                            console.log("Please only use this webpage with WeatherHTML.");
                            alert("Please only use this webpage with WeatherHTML.");
                            window.location.href = "https://weatherhtml.github.io/";
                        }      
                    }, 1000);             
                } else {
                    console.log("This browser does not support clipboard.");
                    alert("This browser does not support clipboard. Please change your default browser to Safari.");
                    window.location.href = "https://weatherhtml.github.io/";
                }
            } else {
                // alert("Please use a mobile device to access this page.");
                // window.location.href = "https://weatherhtml.github.io/";
            }
        }

        var picker = document.getElementById("picker");
        var pickerText = document.getElementById("pickerText");
        var confirm = document.getElementById("confirm");

        picker.ontouchstart = () => {
            pickerText.innerText = "Tap to Change Color"
            confirm.style.display = "block";
        }
        confirm.onpointerup = () => {
            if (navigator.clipboard) {
                console.log("This browser supports clipboard.");
                navigator.clipboard.writeText(picker.value);
                window.location.href = "shortcuts://";
            } else {
                console.log("This browser does not support clipboard.");
                alert("This browser does not support clipboard. Please change your default browser to Safari.");
                window.location.href = "https://weatherhtml.github.io/";
            }
        }
    </script>
</body>

</html>